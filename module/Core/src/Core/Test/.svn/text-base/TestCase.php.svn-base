<?php
namespace Core\Test;

use Zend\Db\Adapter\Adapter;
use Core\Db\TableGateway;
use Zend\Mvc\Application;
use Zend\Di\Di;
use Zend\Mvc\Service\ServiceManagerConfig;
use Zend\Mvc\MvcEvent;
use AdministrativoTest\Bootstrap;

abstract class TestCase extends \PHPUnit_Framework_TestCase
{
   /**
    * 
    * @var ServiceManagerConfig
    */
	protected $serviceManager;
	
    public function setup()
    {
    	$this->serviceManager = Bootstrap::getServiceManager();
        parent::setup();
        $this->createDatabase();
        
    }

    protected function tearDown()
    {
        parent::tearDown();
        $this->dropDatabase();
    }

    
    /**
     * Retrieve Service
     *
     * @param  string $service
     * @return Service
     */
    protected function getService($service)
    {
        return $this->serviceManager->get($service);
    }

    /**
     * @return void
     */
    public function createDatabase()
    {
        $em = $this->getEntityManager();

        $queries = include  Bootstrap::getModulePath().'/tests/data/test.data.php';
        sort($queries);
        foreach ($queries as $query) {
          $em->getConnection()->exec($query['create']);
        }
    }

    /**
     * @return void
     */
    public function dropDatabase()
    {
       	$em = $this->getEntityManager();	        
        $queries = include  Bootstrap::getModulePath().'/tests/data/test.data.php';
        arsort($queries);
        foreach ($queries as $query) {
           $em->getConnection()->exec($query['drop']);
        }
    }

    /**
     * 
     * @return \Doctrine\ORM\EntityManager
     */
    public function getEntityManager() 
    {
        return $this->serviceManager->get('\Doctrine\ORM\EntityManager');
    }
}